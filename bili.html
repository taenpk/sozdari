<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–° –Æ–±–∏–ª–µ–µ–º, –ê–Ω–Ω–∞!</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∏–∫–æ–Ω–∫–∏ Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- –®—Ä–∏—Ñ—Ç—ã -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; 
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        .font-serif {
            font-family: 'Playfair Display', serif;
        }

        /* --- –ù–û–í–ê–Ø –¶–í–ï–¢–û–í–ê–Ø –°–•–ï–ú–ê –ê–ù–ò–ú–ê–¶–ò–ô --- */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob { animation: blob 10s infinite; } /* –ß—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ */
        
        @keyframes shimmer {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        .animate-shimmer {
            background-size: 200% auto;
            animation: shimmer 4s linear infinite;
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        .animate-wiggle { animation: wiggle 2s ease-in-out infinite; } /* –ü–ª–∞–≤–Ω–µ–µ */

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 12s linear infinite; }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fade-in-up 0.8s ease-out forwards; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }

        /* –ö—É—Ä—Å–æ—Ä –ø–µ—á–∞—Ç–Ω–æ–π –º–∞—à–∏–Ω–∫–∏ */
        @keyframes blink {
            0%, 100% { border-color: transparent; }
            50% { border-color: #FCD34D; } /* –ó–æ–ª–æ—Ç–æ–π –∫—É—Ä—Å–æ—Ä */
        }
        .typewriter-cursor {
            border-right: 3px solid #FCD34D;
            animation: blink 0.75s step-end infinite;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .photo-card {
            transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            backface-visibility: hidden;
            transform-origin: center bottom;
        }
        
        .photo-card.swiped {
            transform: translate(100vw, -20deg) rotate(45deg) !important;
            opacity: 0 !important;
        }

        .step-section {
            display: none;
            width: 100%;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .step-section.active {
            display: flex;
        }

        .quiz-option {
            transition: all 0.3s ease;
        }
        .quiz-option:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<!-- –ú–ï–ù–Ø–ï–ú –§–û–ù –ù–ê –ì–õ–£–ë–û–ö–ò–ô –ò–ù–î–ò–ì–û -->
<body class="bg-[#0f172a] text-slate-100">

    <!-- –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ö–ù–û–ü–ö–ê –ó–í–£–ö–ê -->
    <button id="btn-sound" class="fixed top-4 right-4 z-[100] p-3 bg-amber-500/20 backdrop-blur-md border border-amber-500/30 rounded-full shadow-lg text-amber-100 hover:bg-amber-500/40 transition-all hover:scale-110 group active:scale-95">
        <i id="icon-sound-on" data-lucide="volume-2" class="w-6 h-6 group-hover:text-white transition-colors"></i>
        <i id="icon-sound-off" data-lucide="volume-x" class="w-6 h-6 hidden text-slate-400"></i>
    </button>

    <!-- 1. –≠–ö–†–ê–ù –ü–ê–†–û–õ–Ø -->
    <div id="step-password" class="step-section active flex-col items-center justify-center bg-[#0f172a] text-white relative overflow-hidden">
        <!-- –¢–µ–∫—Å—Ç—É—Ä–∞ -->
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-10 animate-pulse"></div>
        
        <!-- –ù–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ blobs (–ó–æ–ª–æ—Ç–æ/–°–∏–Ω–∏–π) -->
        <div class="absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-amber-600 rounded-full blur-[120px] opacity-20 animate-blob"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[400px] h-[400px] bg-blue-600 rounded-full blur-[120px] opacity-20 animate-blob animation-delay-2000"></div>
        
        <div class="bg-white/5 backdrop-blur-xl border border-amber-500/20 p-8 rounded-3xl shadow-2xl max-w-sm w-full text-center animate-fade-in-up z-10 m-4">
            <div class="mb-6 flex justify-center">
                <div class="p-4 bg-gradient-to-br from-amber-400 to-orange-600 rounded-full shadow-lg shadow-amber-500/30">
                    <i data-lucide="lock" class="w-8 h-8 text-white"></i>
                </div>
            </div>
            <h2 class="text-xl font-light mb-6 tracking-widest uppercase text-amber-200">–í—Ö–æ–¥ –Ω–∞ —Ç–æ—Ä–∂–µ—Å—Ç–≤–æ</h2>
            <form id="password-form" class="space-y-6">
                <input
                    id="password-input"
                    type="password"
                    inputmode="numeric" 
                    maxlength="4"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    class="w-full bg-black/40 border border-amber-500/30 rounded-2xl px-4 py-4 text-center text-3xl tracking-[1em] focus:outline-none focus:border-amber-400 transition-all text-white placeholder:text-white/20"
                />
                <button
                    type="submit"
                    class="w-full bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-bold py-4 rounded-2xl transition-all shadow-lg shadow-amber-900/50 transform hover:scale-[1.02] active:scale-95 uppercase tracking-wide"
                >
                    –û—Ç–∫—Ä—ã—Ç—å
                </button>
            </form>
            <div id="preload-status" class="mt-4 text-xs text-white/30 font-light">
                –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–æ–ª–æ—Ç–æ–π –º–∞–≥–∏–∏...
            </div>
        </div>
    </div>

    <!-- 2. –ü–†–ò–í–ï–¢–°–¢–í–ï–ù–ù–´–ô –≠–ö–†–ê–ù -->
    <div id="step-welcome" class="step-section flex-col items-center justify-center bg-gradient-to-b from-[#1e293b] to-[#0f172a] relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
            <div class="absolute top-[10%] left-[10%] w-64 h-64 bg-amber-200 rounded-full mix-blend-overlay filter blur-3xl opacity-10 animate-blob"></div>
            <div class="absolute top-[10%] right-[10%] w-64 h-64 bg-blue-400 rounded-full mix-blend-overlay filter blur-3xl opacity-10 animate-blob animation-delay-2000"></div>
        </div>

        <div class="relative z-10 text-center p-6 md:p-8 max-w-md animate-fade-in flex flex-col items-center w-full">
            <div class="mb-6 inline-block p-3 rounded-full bg-white/5 border border-white/10 shadow-md backdrop-blur-sm">
                <i data-lucide="crown" class="w-8 h-8 text-amber-400 animate-pulse"></i>
            </div>
            <h1 class="text-4xl md:text-6xl font-serif text-white mb-6 leading-tight">
                –Æ–±–∏–ª–µ–π <br />
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-200 via-yellow-400 to-amber-200 animate-shimmer">
                    –ê–Ω–Ω—ã
                </span>
            </h1>
            
            <div class="relative mb-12">
                <p class="text-lg md:text-xl font-serif italic leading-relaxed text-slate-300">
                    "50 –ª–µ—Ç —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç–∏, –º—É–¥—Ä–æ—Å—Ç–∏ –∏ —Ç–µ–ø–ª–∞. <br/>–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ —Ç–≤–æ–π –∑–æ–ª–æ—Ç–æ–π –≤–µ–∫."
                </p>
                <!-- –ó–æ–ª–æ—Ç–∞—è –ª–∏–Ω–∏—è -->
                <div class="absolute -bottom-4 left-1/2 -translate-x-1/2 w-24 h-0.5 bg-gradient-to-r from-transparent via-amber-500 to-transparent"></div>
            </div>
            
            <button
                id="btn-start-journey"
                class="group relative inline-flex items-center justify-center px-12 py-5 font-bold text-white transition-all duration-200 bg-transparent border border-amber-500/50 font-lg rounded-full focus:outline-none hover:bg-amber-500/10 hover:border-amber-400 active:scale-95 shadow-[0_0_20px_rgba(245,158,11,0.2)]"
            >
                <span class="text-amber-100">–ù–∞—á–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</span>
                <i data-lucide="arrow-right" class="ml-3 w-5 h-5 text-amber-400 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </div>

    <!-- 3. –ö–í–ò–ó (–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏) -->
    <div id="step-quiz" class="step-section flex-col items-center justify-center bg-[#0f172a] relative overflow-hidden px-4">
        <!-- –§–æ–Ω -->
        <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-800 via-[#0f172a] to-[#0f172a] z-0"></div>
        
        <div class="relative z-10 w-full max-w-lg">
            <div id="quiz-header" class="text-center mb-6 md:mb-8 animate-fade-in-up">
                <h2 class="text-3xl md:text-4xl font-serif font-bold text-amber-100 mb-2">–ú–æ–º–µ–Ω—Ç—ã –∂–∏–∑–Ω–∏</h2>
                <p class="text-slate-400 text-sm md:text-base">–ö–∞–∫ —Ö–æ—Ä–æ—à–æ –º—ã –∑–Ω–∞–µ–º –∏–º–µ–Ω–∏–Ω–Ω–∏—Ü—É? üåü</p>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–≤–∏–∑–∞: –°—Ç–µ–∫–ª–æ + –ó–æ–ª–æ—Ç–∞—è –æ–±–≤–æ–¥–∫–∞ -->
            <div id="quiz-card" class="bg-slate-800/50 backdrop-blur-xl border border-amber-500/20 p-6 md:p-8 rounded-3xl shadow-2xl transition-all duration-300 animate-fade-in-up">
                <!-- –°—é–¥–∞ JS –±—É–¥–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã -->
            </div>
        </div>
    </div>

    <!-- 4. –ì–ê–õ–ï–†–ï–Ø -->
    <div id="step-gallery" class="step-section flex-col items-center justify-center bg-[#0f172a] relative overflow-hidden px-4">
        
        <!-- –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –®–ö–ê–õ–ê (–ó–æ–ª–æ—Ç–∞—è) -->
        <div class="absolute 
            top-24 left-1/2 -translate-x-1/2 w-64 h-2 
            md:top-1/2 md:left-10 md:translate-x-0 md:-translate-y-1/2 md:h-64 md:w-2
            bg-slate-800 rounded-full flex 
            flex-row md:flex-col 
            justify-start md:justify-end items-center z-20 border border-white/5">
            
            <div 
                id="progress-bar"
                class="bg-gradient-to-r md:bg-gradient-to-t from-amber-700 via-amber-500 to-yellow-200 rounded-full transition-all duration-700 ease-out shadow-[0_0_15px_rgba(245,158,11,0.5)]"
                style="height: 0%; width: 0%;" 
            ></div>
            
            <div class="absolute -right-8 md:right-auto md:-bottom-8 text-amber-400">
                <i id="progress-star" data-lucide="star" class="w-6 h-6"></i>
            </div>
            
            <div id="label-2025" class="absolute -left-12 md:left-auto md:-top-10 font-bold transition-all duration-500 text-slate-500 text-sm md:text-base">
                2025
            </div>
        </div>

        <div class="relative w-full max-w-sm aspect-[3/4] flex items-center justify-center mt-8 md:mt-0">
            
            <div id="gallery-instruction" class="absolute inset-0 flex items-center justify-center text-amber-100/50 text-sm animate-pulse z-0 font-medium tracking-wide pointer-events-none">
                <div class="bg-black/40 backdrop-blur-sm px-4 py-2 rounded-full border border-white/10">
                    üëÜ –õ–ò–°–¢–ê–ô –§–û–¢–û
                </div>
            </div>

            <div id="cards-container" class="relative w-full h-full cursor-pointer perspective-1000">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>

            <!-- –§–∏–Ω–∞–ª –≥–∞–ª–µ—Ä–µ–∏: –ü–æ–¥–∞—Ä–æ–∫ -->
            <div id="gallery-finish" class="hidden flex-col items-center justify-center w-full h-full animate-fade-in-up text-center z-10 relative">
                <div class="mb-8 bg-slate-800/80 backdrop-blur-md p-8 rounded-[2rem] shadow-xl border border-amber-500/30 max-w-xs relative overflow-hidden">
                    <div class="absolute -top-10 -right-10 w-20 h-20 bg-amber-500 rounded-full blur-2xl opacity-20"></div>
                    <p class="font-serif text-2xl text-amber-100 italic leading-snug">
                        "–ó–æ–ª–æ—Ç–æ–π –≤–æ–∑—Ä–∞—Å—Ç ‚Äî <br/>–∑–æ–ª–æ—Ç—ã–µ –º–µ—á—Ç—ã..."
                    </p>
                </div>
                
                <button
                    id="btn-to-celebration"
                    class="group relative bg-gradient-to-br from-amber-100 to-amber-200 text-slate-900 p-6 rounded-full shadow-[0_0_30px_rgba(245,158,11,0.4)] transition-all hover:scale-110 active:scale-95"
                >
                    <div class="absolute inset-0 bg-white rounded-full animate-ping opacity-20"></div>
                    <div class="relative rounded-full p-4">
                        <i data-lucide="gift" class="w-12 h-12 text-amber-600 animate-wiggle"></i>
                    </div>
                </button>
                <span class="mt-6 text-amber-200/50 text-sm font-medium tracking-widest uppercase animate-pulse">–û—Ç–∫—Ä—ã—Ç—å —Å—é—Ä–ø—Ä–∏–∑</span>
            </div>
        </div>
    </div>

    <!-- 5. –§–ò–ù–ê–õ (–°–ê–õ–Æ–¢) -->
    <div id="step-celebration" class="step-section flex-col items-center justify-center bg-[#050b14] overflow-hidden text-center px-4 relative">
        <!-- Canvas –¥–ª—è —Å–∞–ª—é—Ç–∞ -->
        <canvas id="fireworks-canvas" class="absolute inset-0 z-0 pointer-events-none"></canvas>
        
        <button id="btn-restart" class="absolute top-4 left-4 z-50 p-3 bg-white/5 backdrop-blur-md rounded-full text-white/50 hover:text-white hover:bg-white/10 transition-all hover:scale-105 group active:scale-95" title="–í –Ω–∞—á–∞–ª–æ">
            <div class="flex items-center gap-2">
                <i data-lucide="rotate-ccw" class="w-5 h-5 group-hover:-rotate-90 transition-transform duration-500"></i>
            </div>
        </button>

        <div class="relative z-10 max-w-3xl w-full flex flex-col items-center pt-16 pb-20 overflow-y-auto max-h-screen no-scrollbar">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="mb-8 animate-fade-in-up relative flex-shrink-0 mt-8">
                <i data-lucide="star" class="absolute -top-12 -right-8 w-12 h-12 text-amber-300 animate-spin-slow opacity-80"></i>
                
                <h1 class="text-5xl md:text-8xl font-bold font-serif leading-none tracking-tight">
                    <span class="block text-slate-300 text-3xl md:text-5xl mb-4 font-light tracking-widest uppercase">–ê–Ω–Ω–∞</span>
                    <span class="text-transparent bg-clip-text bg-gradient-to-b from-amber-200 via-yellow-400 to-amber-600 animate-shimmer drop-shadow-lg">
                        50 –õ–ï–¢
                    </span>
                </h1>
            </div>

            <!-- 1) –ö–ê–†–¢–û–ß–ö–ê TYPEWRITER (–ú–∞–≥–∏—á–µ—Å–∫–æ–µ –ø–∏—Å—å–º–æ - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å) -->
            <div class="bg-slate-900/60 backdrop-blur-md border border-amber-500/30 p-6 md:p-8 rounded-xl shadow-2xl mb-8 mx-4 w-full max-w-lg animate-fade-in-up flex-shrink-0 min-h-[160px] flex items-center justify-center" style="animation-delay: 0.3s;">
                <p id="typewriter-text" class="text-lg md:text-xl text-amber-50 leading-relaxed font-light font-serif italic typewriter-cursor">
                    <!-- –¢–µ–∫—Å—Ç –±—É–¥–µ—Ç –ø–µ—á–∞—Ç–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </p>
            </div>

            <!-- 2) –ö–ê–†–£–°–ï–õ–¨ –ü–û–ñ–ï–õ–ê–ù–ò–ô -->
            <div class="w-full max-w-lg mb-8 animate-fade-in-up px-2" style="animation-delay: 0.5s;">
                <div class="text-center mb-4">
                    <h3 class="text-xs md:text-sm font-bold text-amber-500/70 uppercase tracking-[0.2em]">–¢–µ–ø–ª—ã–µ —Å–ª–æ–≤–∞</h3>
                </div>
                
                <div class="bg-white/5 backdrop-blur-md border border-white/5 rounded-2xl p-2 flex items-center gap-2">
                    <button id="carousel-prev" class="p-3 md:p-2 rounded-full bg-white/5 hover:bg-white/10 text-amber-200 transition-colors active:scale-95">
                        <i data-lucide="chevron-left" class="w-6 h-6"></i>
                    </button>
                    
                    <div id="carousel-content" class="flex-1 text-center py-4 px-2 min-h-[140px] flex flex-col items-center justify-center transition-all duration-300">
                        <!-- JS –∑–∞–ø–æ–ª–Ω–∏—Ç —ç—Ç–æ -->
                    </div>

                    <button id="carousel-next" class="p-3 md:p-2 rounded-full bg-white/5 hover:bg-white/10 text-amber-200 transition-colors active:scale-95">
                        <i data-lucide="chevron-right" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <!-- 3) –¢–ê–ô–ù–´–ô –ü–û–î–ê–†–û–ö (–ó–æ–ª–æ—Ç–∞—è –∫–Ω–æ–ø–∫–∞) -->
            <a 
                href="#" 
                id="secret-gift-btn"
                class="group relative inline-flex items-center gap-3 bg-gradient-to-r from-amber-500 via-yellow-500 to-amber-600 hover:from-amber-400 hover:to-yellow-400 text-slate-900 font-bold py-5 px-10 rounded-full shadow-[0_0_40px_rgba(245,158,11,0.3)] transition-all transform hover:-translate-y-1 overflow-hidden animate-fade-in-up flex-shrink-0 border border-yellow-300/30"
                style="animation-delay: 0.7s;"
            >
                <div class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/40 to-transparent -translate-x-full group-hover:animate-shine"></div>
                <i data-lucide="sparkles" class="w-6 h-6 text-slate-900"></i>
                <span class="text-lg uppercase tracking-wide">–ì–ª–∞–≤–Ω—ã–π –ü–æ–¥–∞—Ä–æ–∫</span>
                <i data-lucide="chevron-right" class="w-6 h-6 group-hover:translate-x-1 transition-transform"></i>
            </a>
            <div class="h-20"></div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        lucide.createIcons();

        // --- –î–ê–ù–ù–´–ï –° –ú–ò–õ–´–ú–ò –ü–û–ó–î–†–ê–í–õ–ï–ù–ò–Ø–ú–ò ---
        const photos = [
            { id: 1, color: 'from-amber-100 to-orange-100', url: 'https://lh3.googleusercontent.com/d/1l6sHPZ5h1EK1fKnxTlPC3mVAgIoMUeI_=s1000?authuser=0', text: '–ö–æ—Ä–æ–ª–µ–≤–∞ –≤–µ—á–µ—Ä–∞ üëë' },
            { id: 2, color: 'from-slate-100 to-zinc-200', url: 'https://lh3.googleusercontent.com/d/1ENzTUw9xgDhG0PRPqSHXjia96js8ZeYA=s1000?authuser=0', text: '–≠–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç—å –≤–æ –≤—Å–µ–º üíé' },
            { id: 3, color: 'from-blue-100 to-indigo-100', url: 'https://lh3.googleusercontent.com/d/1RUcmE8zekLly68zqKmWPJxtSYddN9IXW=s1000?authuser=0', text: '–ú—É–¥—Ä–∞—è –∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è üåü' },
            { id: 4, color: 'from-pink-100 to-rose-100', url: 'https://lh3.googleusercontent.com/d/1nHKoJVFhGwZN1Dpp-xS20jErTCzcI0h4=s1000?authuser=0', text: '–£–ª—ã–±–∫–∞, —á—Ç–æ –≥—Ä–µ–µ—Ç –Ω–∞—Å ‚òÄÔ∏è' },
            { id: 5, color: 'from-purple-100 to-fuchsia-100', url: 'https://lh3.googleusercontent.com/d/1nNTyG4v-FbOXCjYJtx81ZsYi3TgdHD6M=s1000?authuser=0', text: '–õ—é–±–∏–º–∞—è –º–∞–º–∞ –∏ –∂–µ–Ω–∞ ‚ù§Ô∏è' },
            { id: 6, color: 'from-emerald-100 to-teal-100', url: 'https://lh3.googleusercontent.com/d/1-AwGqe3KNGD_Rb-mORTXR3GBVWoZBMmo=s1000?authuser=0', text: '–° –Æ–±–∏–ª–µ–µ–º! üåπ' },
        ];

        // --- –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –í–û–ü–†–û–°–´ –ö–í–ò–ó–ê ---
        const quizQuestions = [
            {
                id: 1,
                from: "–°–µ–º—å–∏",
                text: "–ë–µ–∑ —á–µ–≥–æ –ê–Ω–Ω–∞ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤–æ–µ –∏–¥–µ–∞–ª—å–Ω–æ–µ —É—Ç—Ä–æ?",
                options: ["–ë–µ–∑ –ø—Ä–æ–±–µ–∂–∫–∏", "–ë–µ–∑ —á–∞—à–µ—á–∫–∏ –∫–æ—Ñ–µ", "–ë–µ–∑ –Ω–æ–≤–æ—Å—Ç–µ–π", "–ë–µ–∑ –∑–≤–æ–Ω–∫–∞ –ø–æ–¥—Ä—É–≥–µ"],
                correctIndex: 1
            },
            {
                id: 2,
                from: "–î—Ä—É–∑–µ–π",
                text: "–ö–∞–∫–æ–π —Å—É–ø–µ—Ä—Å–∏–ª–æ–π –æ–±–ª–∞–¥–∞–µ—Ç –Ω–∞—à–∞ –∏–º–µ–Ω–∏–Ω–Ω–∏—Ü–∞?",
                options: ["–í—Å–µ —É—Å–ø–µ–≤–∞—Ç—å", "–õ–µ—á–∏—Ç—å —Å–ª–æ–≤–æ–º", "–ì–æ—Ç–æ–≤–∏—Ç—å —à–µ–¥–µ–≤—Ä—ã –∏–∑ –Ω–∏—á–µ–≥–æ", "–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–µ—Ä–Ω—ã!"],
                correctIndex: 3
            },
            {
                id: 3,
                from: "–ö–æ–ª–ª–µ–≥",
                text: "–ì–ª–∞–≤–Ω—ã–π –¥–µ–≤–∏–∑ –ê–Ω–Ω—ã –ø–æ –∂–∏–∑–Ω–∏?",
                options: ["–¢–∏—à–µ –µ–¥–µ—à—å - –¥–∞–ª—å—à–µ –±—É–¥–µ—à—å", "–í—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ!", "–°—Ç—Ä–æ–≥–æ—Å—Ç—å –∏ –ø–æ—Ä—è–¥–æ–∫", "–ù–∏ –¥–Ω—è –±–µ–∑ —É–ª—ã–±–∫–∏"],
                correctIndex: 1
            }
        ];

        // --- –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ü–û–ñ–ï–õ–ê–ù–ò–Ø ---
        const wishes = [
            { from: "–î–µ—Ç–∏", text: "–ú–∞–º–æ—á–∫–∞, —Ç—ã –Ω–∞—à –ø—Ä–∏–º–µ—Ä –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Å–∏–ª—ã. –ú—ã —Ç–æ–±–æ–π –≤–æ—Å—Ö–∏—â–∞–µ–º—Å—è!" },
            { from: "–ú—É–∂", text: "50 –ª–µ—Ç ‚Äî —ç—Ç–æ –ª–∏—à—å –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–π –≥–ª–∞–≤—ã. –õ—é–±–ª—é —Ç–µ–±—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ." },
            { from: "–ü–æ–¥—Ä—É–≥–∏", text: "–°–≤–µ—Ç–∏, —Å–∏—è–π –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–Ω—ã–≤–∞–π! –¢—ã —É–∫—Ä–∞—à–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –º–∏—Ä–∞." }
        ];

        let currentIndex = 0; 
        let currentQuizIndex = 0; 
        let quizScore = 0; 
        let currentWishIndex = 0; 
        let isSoundEnabled = true;
        // Declare fireworks variables here to be accessible globally
        let fireworksInterval = null;
        let fireworksAnimationFrame = null;

        // --- –ü–†–ï–î–ó–ê–ì–†–£–ó–ö–ê ---
        (function preloadImages() {
            const preloadStatus = document.getElementById('preload-status');
            let loadedCount = 0;
            photos.forEach(photo => {
                const img = new Image();
                img.src = photo.url;
                img.referrerPolicy = "no-referrer";
                img.onload = () => {
                    loadedCount++;
                    if(preloadStatus) preloadStatus.textContent = `–§–æ—Ç–æ –≥–æ—Ç–æ–≤–æ: ${loadedCount}/${photos.length}`;
                };
            });
        })();

        // --- –ó–í–£–ö–ò (–û—Å—Ç–∞–≤–ª–µ–Ω—ã –º—è–≥–∫–∏–µ, –∫–∞–∫ –ø—Ä–æ—Å–∏–ª–∏) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const bufferSize = audioCtx.sampleRate * 2; 
        const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        const output = noiseBuffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) { output[i] = Math.random() * 2 - 1; }

        function playPageTurn() {
            if (!isSoundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const noise = audioCtx.createBufferSource();
            noise.buffer = noiseBuffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass'; filter.frequency.setValueAtTime(600, audioCtx.currentTime);
            filter.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2);
            const gain = audioCtx.createGain();
            noise.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.04, now + 0.05);
            gain.gain.linearRampToValueAtTime(0, now + 0.2);
            noise.start(now); noise.stop(now + 0.2);
        }

        function playSuccessSound() {
            if (!isSoundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            const frequencies = [523.25, 659.25, 783.99]; 
            frequencies.forEach((freq, index) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.type = 'sine'; osc.frequency.value = freq;
                const startTime = now + (index * 0.05);
                gain.gain.setValueAtTime(0, startTime);
                gain.gain.linearRampToValueAtTime(0.05, startTime + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, startTime + 1.2);
                osc.start(startTime); osc.stop(startTime + 1.2);
            });
        }

        function playFireworkSound() {
            if (!isSoundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const noise = audioCtx.createBufferSource();
            noise.buffer = noiseBuffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass'; filter.frequency.value = 400; 
            const gain = audioCtx.createGain();
            noise.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            gain.gain.setValueAtTime(0.05, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
            noise.start(now); noise.stop(now + 1.5);
        }

        // --- –õ–û–ì–ò–ö–ê ---
        function showStep(stepId) {
            document.querySelectorAll('.step-section').forEach(el => el.classList.remove('active'));
            document.getElementById(stepId).classList.add('active');
            if (stepId === 'step-celebration') {
                startFireworks();
                startTypewriter();
                renderWish();
            } else {
                stopFireworks();
            }
        }

        document.getElementById('password-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const input = document.getElementById('password-input');
            if (input.value === '5555') {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                showStep('step-welcome');
            } else {
                input.classList.add('animate-shake', 'border-red-500');
                input.value = '';
                setTimeout(() => input.classList.remove('animate-shake', 'border-red-500'), 500);
            }
        });

        document.getElementById('btn-start-journey').addEventListener('click', () => {
            initQuiz();
            showStep('step-quiz');
        });

        // --- –ö–í–ò–ó (–° –Ω–æ–≤—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏) ---
        function initQuiz() {
            currentQuizIndex = 0; quizScore = 0;
            document.getElementById('quiz-header').style.display = 'block';
            renderQuizQuestion();
        }

        function renderQuizQuestion() {
            const quizContainer = document.getElementById('quiz-card');
            if (currentQuizIndex >= quizQuestions.length) { renderQuizResult(); return; }
            const q = quizQuestions[currentQuizIndex];
            const progress = `–í–æ–ø—Ä–æ—Å ${currentQuizIndex + 1} –∏–∑ ${quizQuestions.length}`;

            let html = `
                <div class="flex justify-between items-center mb-4 text-sm text-slate-400 font-medium uppercase tracking-wider">
                    <span>${progress}</span>
                    <span class="text-amber-400 bg-amber-500/10 px-2 py-1 rounded-md border border-amber-500/20">–ë–∞–ª–ª—ã: ${quizScore}</span>
                </div>
                <div class="mb-6">
                    <span class="inline-block px-3 py-1 bg-gradient-to-r from-amber-500/20 to-orange-500/20 text-amber-300 rounded-full text-xs font-bold mb-3 border border-amber-500/30">
                        üíå ${q.from}
                    </span>
                    <h3 class="text-xl md:text-2xl font-bold text-slate-100 leading-snug">${q.text}</h3>
                </div>
                <div class="space-y-3">
            `;
            q.options.forEach((opt, idx) => {
                html += `
                    <button onclick="handleQuizAnswer(${idx}, this)" class="quiz-option w-full text-left p-4 rounded-xl border border-slate-600 bg-slate-700/50 text-slate-200 font-medium hover:border-amber-400 hover:bg-slate-700 active:scale-[0.98] flex items-center justify-between group">
                        <span>${opt}</span>
                        <span class="icon-wrapper"><i data-lucide="circle" class="w-5 h-5 text-slate-500 group-hover:text-amber-400"></i></span>
                    </button>
                `;
            });
            html += `</div><div id="quiz-feedback" class="h-6 mt-3 text-center text-sm font-bold text-red-400 opacity-0 transition-opacity">–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ üîÑ</div>`;
            quizContainer.innerHTML = html;
            lucide.createIcons();
        }

        function handleQuizAnswer(selectedIndex, btnElement) {
            const q = quizQuestions[currentQuizIndex];
            const feedbackEl = document.getElementById('quiz-feedback');
            const allBtns = document.querySelectorAll('.quiz-option');

            if (selectedIndex === q.correctIndex) {
                playSuccessSound();
                quizScore += 10;
                btnElement.classList.remove('border-slate-600', 'bg-slate-700/50', 'text-slate-200');
                btnElement.classList.add('bg-amber-500/20', 'border-amber-400', 'text-amber-200', 'shadow-[0_0_15px_rgba(251,191,36,0.3)]');
                const iconWrapper = btnElement.querySelector('.icon-wrapper');
                if (iconWrapper) { iconWrapper.innerHTML = '<i data-lucide="check-circle" class="w-5 h-5 text-amber-400"></i>'; lucide.createIcons(); }
                allBtns.forEach(btn => btn.disabled = true);
                setTimeout(() => { currentQuizIndex++; renderQuizQuestion(); }, 800);
            } else {
                btnElement.classList.add('animate-shake', 'border-red-500', 'bg-red-500/10');
                feedbackEl.style.opacity = '1';
                setTimeout(() => { btnElement.classList.remove('animate-shake', 'border-red-500', 'bg-red-500/10'); feedbackEl.style.opacity = '0'; }, 800);
            }
        }

        function renderQuizResult() {
            const quizContainer = document.getElementById('quiz-card');
            document.getElementById('quiz-header').style.display = 'none';
            quizContainer.innerHTML = `
                <div class="text-center py-8">
                    <div class="inline-flex p-4 bg-amber-500/10 border border-amber-500/30 rounded-full text-amber-400 mb-6 shadow-sm">
                        <i data-lucide="trophy" class="w-12 h-12 animate-bounce"></i>
                    </div>
                    <h3 class="text-3xl font-serif font-bold text-amber-100 mb-4">–ë–ª–µ—Å—Ç—è—â–µ!</h3>
                    <p class="text-lg text-slate-300 mb-2">–¢—ã –Ω–∞–±—Ä–∞–ª–∞ <span class="text-amber-400 font-bold text-2xl">${quizScore}</span> –±–∞–ª–ª–æ–≤!</p>
                    <button id="btn-quiz-finish" class="mt-8 w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white font-bold py-4 rounded-xl shadow-lg hover:scale-[1.02] transition-transform flex items-center justify-center gap-2">
                        <span>–°–º–æ—Ç—Ä–µ—Ç—å —Ñ–æ—Ç–æ</span><i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>
                </div>
            `;
            lucide.createIcons();
            document.getElementById('btn-quiz-finish').addEventListener('click', () => {
                renderCards(); updateProgress(); showStep('step-gallery');
            });
        }

        // --- –ì–ê–õ–ï–†–ï–Ø ---
        const cardsContainer = document.getElementById('cards-container');
        function renderCards() {
            const instruction = document.getElementById('gallery-instruction');
            if (instruction) instruction.style.display = 'flex';
            cardsContainer.innerHTML = '';
            photos.slice(currentIndex).forEach((photo, index) => {
                const stackOffset = index; 
                const card = document.createElement('div');
                card.className = `photo-card absolute inset-0 bg-[#1e293b] p-3 pb-10 shadow-2xl rounded-xl cursor-pointer ring-1 ring-white/10`;
                card.style.zIndex = 50 - stackOffset;
                card.style.transform = `scale(${1 - stackOffset * 0.05}) translateY(${stackOffset * 15}px) rotate(${stackOffset % 2 === 0 ? stackOffset * 2 : -stackOffset * 3}deg)`;
                card.style.filter = stackOffset > 0 ? 'brightness(50%)' : 'brightness(100%)'; // –¢–µ–º–Ω–µ–µ –≤ –≥–ª—É–±–∏–Ω–µ
                if (stackOffset > 0) card.style.pointerEvents = 'none'; 

                card.innerHTML = `
                    <div class="w-full h-full bg-gradient-to-br ${photo.color} rounded-lg flex flex-col items-center justify-center relative overflow-hidden group">
                        <img src="${photo.url}" alt="–§–æ—Ç–æ" referrerpolicy="no-referrer" class="absolute inset-0 w-full h-full object-cover pointer-events-none"/>
                        <div class="absolute inset-0 border border-white/20 rounded-lg pointer-events-none"></div>
                        <div class="absolute bottom-8 left-0 w-full text-center px-4 pointer-events-none z-10">
                            <div class="bg-black/60 backdrop-blur-md py-2 px-4 rounded-full shadow-lg inline-block">
                                <span class="text-white font-serif font-medium text-sm whitespace-nowrap">${photo.text}</span>
                            </div>
                        </div>
                    </div>
                `;
                if (stackOffset === 0) {
                    card.onclick = () => {
                        playPageTurn(); card.classList.add('swiped');
                        setTimeout(() => {
                            currentIndex++; updateProgress();
                            if (currentIndex < photos.length) { renderCards(); } 
                            else {
                                cardsContainer.style.display = 'none';
                                if (instruction) instruction.style.display = 'none';
                                document.getElementById('gallery-finish').classList.remove('hidden');
                                document.getElementById('gallery-finish').classList.add('flex');
                                document.getElementById('label-2025').classList.add('text-amber-400');
                                document.getElementById('progress-star').classList.add('fill-amber-400', 'animate-bounce');
                            }
                        }, 200); 
                    };
                }
                cardsContainer.appendChild(card);
            });
        }
        function updateProgress() {
            const percent = (currentIndex / photos.length) * 100;
            const bar = document.getElementById('progress-bar');
            if (window.innerWidth < 768) { bar.style.width = `${percent}%`; bar.style.height = '100%'; } 
            else { bar.style.height = `${percent}%`; bar.style.width = '100%'; }
        }
        window.addEventListener('resize', updateProgress);

        // --- –§–ò–ù–ê–õ ---
        const celebrationText = "–î–æ—Ä–æ–≥–∞—è –ê–Ω–Ω–∞! –í —Ç–≤–æ–∏ 50 –ª–µ—Ç —Ç—ã —Å–∏—è–µ—à—å —è—Ä—á–µ –≤—Å–µ—Ö –∑–≤–µ–∑–¥. –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏—Ç —Å—Ç–æ–ª—å–∫–æ –∂–µ —Å–≤–µ—Ç–∞, —Å–∫–æ–ª—å–∫–æ —Ç—ã –¥–∞—Ä–∏—à—å –Ω–∞–º. –ú—ã –ª—é–±–∏–º —Ç–µ–±—è!";
        let typewriterTimeouts = [];

        function startTypewriter() {
            const el = document.getElementById('typewriter-text');
            typewriterTimeouts.forEach(t => clearTimeout(t)); typewriterTimeouts = [];
            el.innerHTML = ''; let i = 0;
            function type() {
                if (i < celebrationText.length) {
                    el.innerHTML += celebrationText.charAt(i); i++;
                    typewriterTimeouts.push(setTimeout(type, 50));
                } else { setTimeout(() => el.classList.remove('typewriter-cursor'), 1000); }
            }
            type();
        }

        function renderWish() {
            const content = document.getElementById('carousel-content');
            const wish = wishes[currentWishIndex];
            content.style.opacity = 0; content.style.transform = 'scale(0.95)';
            setTimeout(() => {
                content.innerHTML = `
                    <div class="mb-2"><i data-lucide="sparkles" class="w-6 h-6 text-amber-300 inline-block"></i></div>
                    <p class="text-slate-100 text-lg font-light italic leading-relaxed mb-3">"${wish.text}"</p>
                    <p class="text-amber-400 text-sm font-bold uppercase tracking-wider">‚Äî ${wish.from}</p>
                `;
                lucide.createIcons();
                content.style.opacity = 1; content.style.transform = 'scale(1)';
            }, 300);
        }
        document.getElementById('carousel-prev').addEventListener('click', () => { currentWishIndex = (currentWishIndex - 1 + wishes.length) % wishes.length; renderWish(); });
        document.getElementById('carousel-next').addEventListener('click', () => { currentWishIndex = (currentWishIndex + 1) % wishes.length; renderWish(); });

        // Declare btnSound variable first
        const btnSound = document.getElementById('btn-sound');
        btnSound.addEventListener('click', () => {
            isSoundEnabled = !isSoundEnabled;
            if (isSoundEnabled && audioCtx.state === 'suspended') audioCtx.resume();
            document.getElementById('icon-sound-on').classList.toggle('hidden', !isSoundEnabled);
            document.getElementById('icon-sound-off').classList.toggle('hidden', isSoundEnabled);
        });

        document.getElementById('btn-to-celebration').addEventListener('click', () => showStep('step-celebration'));
        document.getElementById('btn-restart').addEventListener('click', () => {
            currentIndex = 0; updateProgress();
            const cardsContainer = document.getElementById('cards-container');
            const finishScreen = document.getElementById('gallery-finish');
            cardsContainer.innerHTML = ''; cardsContainer.style.display = 'block';
            finishScreen.classList.add('hidden'); finishScreen.classList.remove('flex');
            const instruction = document.getElementById('gallery-instruction');
            if(instruction) instruction.style.display = 'flex';
            currentQuizIndex = 0; quizScore = 0; currentWishIndex = 0;
            showStep('step-welcome');
        });
        document.getElementById('secret-gift-btn').addEventListener('click', (e) => { e.preventDefault(); alert("–ó–¥–µ—Å—å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–π–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫!"); });

        // --- –ù–û–í–´–ô –°–ê–õ–Æ–¢ (–ó–æ–ª–æ—Ç–æ–π –¥–æ–∂–¥—å) ---
        function startFireworks() {
            const canvas = document.getElementById('fireworks-canvas');
            const ctx = canvas.getContext('2d');
            let width = window.innerWidth; let height = window.innerHeight;
            canvas.width = width; canvas.height = height;
            window.addEventListener('resize', () => { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; });

            const particles = [];
            // –¶–≤–µ—Ç–∞: –ó–æ–ª–æ—Ç–æ, –ë–µ–ª—ã–π, –ë–ª–µ–¥–Ω–æ-–∂–µ–ª—Ç—ã–π
            const colors = ['#FCD34D', '#F59E0B', '#FFFFFF', '#FEF3C7'];

            function createFirework(x, y) {
                if (Math.random() > 0.3) playFireworkSound();
                const count = 80; // –ë–æ–ª—å—à–µ —á–∞—Å—Ç–∏—Ü
                for (let i = 0; i < count; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 6 + 2; // –†–∞–∑–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                    particles.push({
                        x: x, y: y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        alpha: 1,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        decay: Math.random() * 0.005 + 0.002, // –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
                        gravity: 0.05 // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è (–ø–∞–¥–∞—é—Ç –≤–Ω–∏–∑)
                    });
                }
            }

            if (fireworksInterval) clearInterval(fireworksInterval);
            fireworksInterval = setInterval(() => {
                createFirework(Math.random() * width, Math.random() * (height / 3));
            }, 1000);

            function loop() {
                // –≠—Ñ—Ñ–µ–∫—Ç —à–ª–µ–π—Ñ–∞ (—Ç—Ä–µ–π–ª)
                ctx.globalCompositeOperation = 'destination-out';
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; // –ú–µ–Ω—å—à–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å = –¥–ª–∏–Ω–Ω–µ–µ —Ö–≤–æ—Å—Ç
                ctx.fillRect(0, 0, width, height);
                ctx.globalCompositeOperation = 'lighter';

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += p.gravity; // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é
                    p.vx *= 0.99; // –°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞
                    p.alpha -= p.decay;
                    
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.alpha;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2); // –ú–∞–ª–µ–Ω—å–∫–∏–µ –∏—Å–∫—Ä—ã
                    ctx.fill();

                    if (p.alpha <= 0) particles.splice(i, 1);
                }
                fireworksAnimationFrame = requestAnimationFrame(loop);
            }
            loop();
        }

        function stopFireworks() {
            if (fireworksInterval) clearInterval(fireworksInterval);
            if (fireworksAnimationFrame) cancelAnimationFrame(fireworksAnimationFrame);
            const canvas = document.getElementById('fireworks-canvas');
            if(canvas) { canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height); }
        }
    </script>
</body>
</html>